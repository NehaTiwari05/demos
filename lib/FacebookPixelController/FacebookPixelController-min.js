"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _extends=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o])}return t},_createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,n,o){return n&&t(e.prototype,n),o&&t(e,o),e}}(),FacebookPixelController=function(){function t(e){_classCallCheck(this,t),this.defaultOptions={optOutButtonSelector:".js-fb-opt-out",optInButtonSelector:".js-fb-opt-in",cookieName:"fb-pixel-status",localStorageKey:"fb-pixel-status",secure:!0,pixelId:"1944570812537922",fbScriptSrc:"https://connect.facebook.net/en_US/fbevents.js"},this.options=_extends({},this.defaultOptions,e),this.$optOutButton=document.querySelector(this.options.optOutButtonSelector),this.$optInButton=document.querySelector(this.options.optInButtonSelector),this.usingStorage=t.storageAvailable(),t.setStorage=t.setStorage.bind(this),t.setCookie=t.setCookie.bind(this),t.disableTrackingFunction=t.disableTrackingFunction.bind(this),t.createTrackingScript=t.createTrackingScript.bind(this),this.addEventListeners()}return _createClass(t,[{key:"addEventListeners",value:function t(){var e=this;this.$optOutButton&&this.$optOutButton.addEventListener("click",function(t){t.preventDefault(),e.optOutController()}),this.$optInButton&&this.$optInButton.addEventListener("click",function(t){e.optInController()})}},{key:"optOutController",value:function e(){this.usingStorage&&t.setStorage("opt-out"),t.setCookie("opt-out"),window.hasOwnProperty("fbq")&&t.disableTrackingFunction()}},{key:"optInController",value:function e(){t.setStorage("opt-in"),t.setCookie("opt-in");var n=t.createTrackingScript();document.body.appendChild(n)}},{key:"getStatus",value:function t(){if(this.usingStorage)return localStorage.getItem(this.options.localStorageKey)}},{key:"hasOptedOut",value:function t(){if(this.usingStorage)return"opt-out"===localStorage.getItem(this.options.localStorageKey)}}],[{key:"setStorage",value:function t(e){localStorage.setItem(this.options.localStorageKey,e)}},{key:"setCookie",value:function t(e){if("opt-in"===e||"opt-out"===e){var n=this.options.secure?"secure":"";document.cookie=this.options.cookieName+"="+e+'; expires="Fri, 30 Jan 2071 23:00:00 GMT"; '+n+"; path=/"}else console.error("Invalid state to set the status cookie. Use opt-out or opt-in.")}},{key:"disableTrackingFunction",value:function t(){delete window.fbq}},{key:"createTrackingScript",value:function t(){var e=document.createElement("script");return e.innerText="!function(f,b,e,v,n,t,s)\n      {if(f.fbq)return;n=f.fbq=function(){n.callMethod?\n      n.callMethod.apply(n,arguments):n.queue.push(arguments)};\n      if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';\n      n.queue=[];t=b.createElement(e);t.async=!0;\n      t.src=v;s=b.getElementsByTagName(e)[0];\n      s.parentNode.insertBefore(t,s)}(window, document,'script',\n      '"+this.options.fbScriptSrc+"');\n      fbq('init', '"+this.options.pixelId+"');\n      fbq('track', 'PageView');",e}},{key:"storageAvailable",value:function t(){var e=localStorage,n="__storage_test__";try{return e.setItem(n,n),e.removeItem(n),!0}catch(t){return t instanceof DOMException&&(22===t.code||1014===t.code||"QuotaExceededError"===t.name||"NS_ERROR_DOM_QUOTA_REACHED"===t.name)&&0!==e.length}}}]),t}();new FacebookPixelController;